import React,
{
useState,
useEffect
}

from 'react';
import io from 'socket.io-client';

const socket=io('http://192.168.2.127:3000');

export default function AppMotorista() {
  const [entregas,
  setEntregas]=useState([]);
  const [status,
  setStatus]=useState("Localizando...");

  useEffect(()=> {
      socket.on('NOVA_ROTA', (d)=> {
          setEntregas(d.entregas); alert("üîî Nova rota recebida!");
        });
      socket.on('ENTREGA_CONCLUIDA', (d)=> setEntregas(p=> p.filter(e=> e.id !==d.id)));

      navigator.geolocation.watchPosition((p)=> {
          socket.emit('posicao_motorista', {
            lat: p.coords.latitude, lng: p.coords.longitude
          });
        setStatus("GPS Ativo ‚úÖ");
      }

      ,
      ()=> setStatus("Erro no GPS ‚ùå"),
      {
      enableHighAccuracy: true
    });
  return ()=> socket.off();
}

, []);

return (<div style= {
      {
      padding: '20px', background: 'var(--bg-dark)', color: 'var(--text-main)', minHeight: '100vh', fontFamily: 'sans-serif'
    }
  }

  > <div style= {
      {
      textAlign: 'center', marginBottom: '30px'
    }
  }

  > <div style= {
      {
      fontSize: '24px', fontWeight: 'bold', color: 'var(--primary)'
    }
  }

  >TRUCK GO</div> <div style= {
      {
      fontSize: '12px', color: 'var(--text-muted)'
    }
  }

  > {
    status
  }

  </div> </div> {
    entregas.length===0 ? (<div style= {
          {
          textAlign: 'center', color: '#444', marginTop: '100px'
        }
      }

      > <div style= {
          {
          fontSize: '60px'
        }
      }

      >üöõ</div> <p>Aguardando novas entregas...</p> </div>) : (entregas.map((e, i)=> (<div key= {
            e.id
          }

          style= {
            mCard
          }

          > <div style= {
              {
              color: 'var(--primary)', fontWeight: 'bold', fontSize: '12px'
            }
          }

          >PARADA {
            i+1
          }

          </div> <div style= {
              {
              fontSize: '20px', margin: '5px 0'
            }
          }

          > {
            e.cliente
          }

          </div> <div style= {
              {
              color: 'var(--text-muted)', fontSize: '14px', marginBottom: '20px'
            }
          }

          >üìç {
            e.endereco
          }

          </div> <button onClick= {
            ()=> {
              socket.emit('entrega_feita', e.id); setEntregas(p=> p.filter(x=> x.id !==e.id));
            }
          }

          style= {
            mBtn
          }

          > CONCLUIR ENTREGA </button> </div>)))
  }

  </div>);
}

const mCard= {
  background: 'var(--card)', padding: '20px', borderRadius: '15px', marginBottom: '15px', boxShadow: '0 4px 15px rgba(0,0,0,0.5)'
}

;

const mBtn= {
  width: '100%', padding: '15px', background: 'var(--primary)', color: 'var(--btn-text)', border: 'none', borderRadius: '10px', fontWeight: 'bold', fontSize: '16px'
}

;